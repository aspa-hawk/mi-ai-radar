name: AI Radar Pro - Telegram
on:
  schedule:
    - cron: '0 */12 * * *'  # Cada 12 horas
  workflow_dispatch:

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: pip install feedparser requests
      - name: Run AI Radar & Send to Replit
        env:
          RADAR_SECRET_KEY: ${{ secrets.RADAR_SECRET_KEY }}
        run: |
          python <<EOF
          import feedparser
          import requests
          from datetime import datetime, timedelta

          SOURCES = {
              "ğŸ¤– Generative AI": "https://huggingface.co/models?pipeline_tag=text-to-video&sort=modified&rss=true",
              "ğŸ•µï¸ Deepfakes": "https://realitydefender.com/blog/rss/",
              "ğŸ›¡ï¸ MITRE ATLAS": "https://atlas.mitre.org/updates.rss",
              "ğŸ”¬ arXiv CV": "http://arxiv.org/rss/cs.CV",
              "ğŸ™ GitHub AI": "https://github.com/trending?l=python&since=daily&q=ai"
          }

          IMPACT = ["deepfake", "exploit", "launch", "SOTA", "voice cloning", "agent"]

          def has_signal(txt):
              return any(k in txt.lower() for k in IMPACT)

          alerts = []
          cutoff = datetime.now() - timedelta(hours=24)

          for cat, url in SOURCES.items():
              try:
                  feed = feedparser.parse(url)
                  for e in feed.entries:
                      pub = datetime(*e.published_parsed[:6]) if e.published_parsed else datetime.min
                      if pub > cutoff and has_signal(e.title + " " + getattr(e, 'summary', '')):
                          alerts.append(f"â€¢ <a href='{e.link}'>{e.title[:70]}...</a>")
              except: pass

          if alerts:
              msg = "ğŸŒŒ <b>AI Radar GalÃ¡ctico</b> â€” Ãšltimas 24h\\n\\n" + "\\n".join(alerts)
              payload = {"message": msg}
              headers = {"X-Secret-Key": "${{ secrets.RADAR_SECRET_KEY }}", "Content-Type": "application/json"}
              r = requests.post("https://ai-radar-asistente.archaeologist20.repl.co/ingest-alert", json=payload, headers=headers)
              print("âœ… Alerta enviada a Replit" if r.status_code == 200 else f"âŒ Error: {r.text}")
          else:
              print("ğŸ˜´ Nada nuevo.")
          EOF
